@{
    ViewData["Title"] = "Admin Panel";
}
<div class="container mt-5">
    <h1 class="text-center mb-4">Ürün Listesi</h1>
    <div class="d-flex justify-content-center mb-3">
        <button id="loadProducts" class="btn btn-primary">Ürünleri Getir</button>
    </div>

    <table class="table table-striped table-bordered text-center" id="productTable">
        <thead>
            <tr>
                <th>Ürün Adı</th>
                <th>Ürün Açıklaması</th>
                <th>Fiyat</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            <!-- Ürün satırları buraya eklenecek -->
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $("#loadProducts").click(function () {
        $.ajax({
            url: "http://localhost:5001/api/Product/getall",
            method: "GET",
            dataType: "json",
            success: function (response) {
                console.log("API'den gelen yanıt:", response); // Veriyi kontrol etmek için

                if (Array.isArray(response.data)) {
                    $("#productTable tbody").empty(); // Tablodaki mevcut satırları temizle
                    response.data.forEach(product => {
                        // Her ürün için bir satır oluştur
                        const row = `
                                <tr>
                                    <td>${product.name}</td>
                                    <td>${product.description}</td>
                                    <td>${product.price}₺</td>
                                    <td><button class="deleteProduct" data-id="${product.id}">Sil</button></td>
                                </tr>
                            `;
                        $("#productTable tbody").append(row);
                    });

                    // Silme butonu için click event'ini bağlama
                    $(".deleteProduct").click(function () {
                        const productId = $(this).data("id");
                        deleteProduct(productId, $(this).closest("tr")); // Ürün ID ve satırı parametre olarak gönder
                    });
                } else {
                    console.error("Beklenen veri formatı bir dizi değil:", response);
                }
            },
            error: function (err) {
                console.error("Hata oluştu:", err);
            }
        });
    });

    // Ürün silme işlemi
    function deleteProduct(productId, row) {
        $.ajax({
            url: `http://localhost:5001/api/Product/delete`, 
            method: "DELETE",
            success: function () {
                console.log(`Ürün (ID: ${productId}) silindi.`);
                row.remove(); // Başarıyla silindiğinde tablo satırını kaldır
            },
            error: function (err) {
                console.error("Silme işlemi sırasında hata oluştu:", err);
            }
        });
    }
</script>
